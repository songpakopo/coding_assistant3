{% extends 'layout.html' %}

{% block title %}
Stock List
{% endblock %}

{% block content %}
  <h1 class="mb-4">Stock List</h1>
  
  <!-- Search Form -->
  <form method="get" action="{{ url_for('index') }}" class="mb-3">
    <div class="input-group">
      <input type="text" name="search" class="form-control" placeholder="Search by name or code" value="{{ search_query }}">
      <div class="input-group-append">
        <button type="submit" class="btn btn-outline-secondary">Search</button>
      </div>
    </div>
  </form>

  <a href="{{ url_for('add') }}" class="btn btn-primary mb-3">Add New Stock</a>
  
  <table class="table table-striped">
    <thead class="thead-dark">
      <tr>
        <th><a href="{{ url_for('index', sort_by='code', sort_order='asc' if sort_by != 'code' or sort_order == 'desc' else 'desc', search=search_query) }}">종목코드</a></th>
        <th><a href="{{ url_for('index', sort_by='name', sort_order='asc' if sort_by != 'name' or sort_order == 'desc' else 'desc', search=search_query) }}">회사명</a></th>
        <th><a href="{{ url_for('index', sort_by='price', sort_order='asc' if sort_by != 'price' or sort_order == 'desc' else 'desc', search=search_query) }}">현재가</a></th>
        <th><a href="{{ url_for('index', sort_by='volume', sort_order='asc' if sort_by != 'volume' or sort_order == 'desc' else 'desc', search=search_query) }}">거래량</a></th>
        <th><a href="{{ url_for('index', sort_by='prediction', sort_order='asc' if sort_by != 'prediction' or sort_order == 'desc' else 'desc', search=search_query) }}">예측</a></th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for item in data %}
      <tr>
        <td>{{ item.code }}</td>
        <td>{{ item.name }}</td>
        <td>{{ item.price }}</td>
        <td>{{ item.volume }}</td>
        <td>{{ item.prediction }}</td>
        <td>
          <a href="{{ url_for('edit', row_id=item.id) }}" class="btn btn-sm btn-warning">Edit</a>
          <a href="{{ url_for('delete', row_id=item.id) }}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this item?')">Delete</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination -->
  {% if total_pages > 1 %}
  <nav aria-label="Page navigation">
    <ul class="pagination">
      {% if page > 1 %}
      <li class="page-item"><a class="page-link" href="{{ url_for('index', page=page-1, sort_by=sort_by, sort_order=sort_order, search=search_query) }}">Previous</a></li>
      {% endif %}
      
      {% for p in range(1, total_pages + 1) %}
      <li class="page-item {% if p == page %}active{% endif %}"><a class="page-link" href="{{ url_for('index', page=p, sort_by=sort_by, sort_order=sort_order, search=search_query) }}">{{ p }}</a></li>
      {% endfor %}
      
      {% if page < total_pages %}
      <li class="page-item"><a class="page-link" href="{{ url_for('index', page=page+1, sort_by=sort_by, sort_order=sort_order, search=search_query) }}">Next</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

{% endblock %}